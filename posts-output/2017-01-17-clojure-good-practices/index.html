<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta charset="utf-8"/>
    <title>The Analytic Bastard: Clojure good practices</title>
    <link rel="canonical" href="http://analyticbastard.github.io/posts-output/2017-01-17-clojure-good-practices/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='http://fonts.googleapis.com/css?family=Alegreya:400italic,700italic,400,700' rel='stylesheet'
          type='text/css'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/default.min.css">
    <link href="/css/screen.css" rel="stylesheet" type="text/css" />
</head>
<body>


<nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">The Analytic Bastard</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li ><a href="/">Home</a></li>
                <li
                ><a href="/archives/">Archives</a></li>
                
                <li
                >
                <a href="/pages-output/about/">About</a>
                </li>
                
                <li><a href="/feed.xml">RSS</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div><!--/.container-fluid -->
</nav>


<div class="container">


    <div class="row">
        <div class="col-lg-9">
            <div id="content">
                
<div id="post">
    <div class="post-header">
    <div id="post-meta" class="row">
        <div class="col-lg-6">January 17, 2017</div>
        
    </div>
    <h2>Clojure good practices</h2>
</div>
<div>
    
    <p>Reloadable code makes the developer's life easier, making it possible to change the code and hotload it on the fly into a running system, or reload it minimizing the impact on it.</p><p>In my experience working with Clojure, I have founds a couple of guidelines that allow me to follow this principle. I will summarize them next:</p><ol><li>Keep the logic out of records and other types of static structures   and put it into functions.   <br><br>   Since protocols are essentially like Java classes, they need to be   recompiled and then the objects referenced again. This forces us to   restart the system and relink everything until we use new instances   of the new versions.   <br><br>   On the other hand, calling a function is always done by name and   each call will use the most up-to-date version, this is, the symbol   redefines to point to the last version and each symbol evaluation   uses the last version.   <br><br>   Therefore, if we extract the login out of the record, the record   will only evaluate a function that can be redefined, and we will   need to restart a running system whenever we actually change   the definition of the record in question (adding/removing methods, etc)   <br><br>   Therefore, using the following record:   <br><br><pre><code class="clojure">   &#40;defprotocol P
     &#40;meth1 &#91;this&#93;&#41;&#41;
</code></pre>   <br><br>   Bad version:<pre><code class="clojure">   &#40;defrecord rec &#91;a b&#93;
     P
     &#40;meth1 &#91;this&#93;
       &#40;assoc this :res &#40;&#42; a b&#41;&#41;&#41;&#41;
</code></pre>   <br><br>   Good version:<pre><code class="clojure">   &#40;defn mult-R &#91;{:keys &#91;a b&#93; :as &#95;}&#93;
     &#40;&#42; a b&#41;&#41;
   &#40;defrecord R &#91;a b&#93;
     P
     &#40;meth1 &#91;this&#93;
       &#40;assoc this :res &#40;mult-R this&#41;&#41;&#41;&#41;
</code></pre></li><li>We face a similar problem with Compojure routes. When we change the   login inside the routes, we need to restart the system and even reload   the namespaces. This not only throws away any state we might hold, but   also forces the system to potentially open database connections and   other resources again.   <br><br>   The same principle as before applies here: by extracting the logic   out of the route and into a function, the route just makes an   evaluation of the function, which can easily be reloaded into the   REPL.   <br><br>   Bad version:<pre><code class="clojure">   &#40;GET &quot;/system-stuff&quot; &#91;&#93;
       :query-params &#91;args :- String&#93;
       &#40;fn &#91;system&#93;
           &#40;perform-system-stuff system args&#41;&#41;&#41;
</code></pre>   <br><br>   Good version:<pre><code class="clojure">   &#40;defn build-perform-system-stuff &#91;args&#93;
       &#40;fn &#91;system&#93;
           &#40;perform-system-stuff system args&#41;&#41;&#41;
   &#40;GET &quot;/system-stuff&quot; &#91;&#93;
       :query-params &#91;args :- String&#93;
       &#40;build-perform-system-stuff args&#41;&#41;
</code></pre></li></ol><p>Another good thing is that some debuggers simply won't place breakpoints on code within records or routes. By following the above points, we will be able to better debug our code.</p><p>The above strategies aim at improving developing times by reducing the reload times. The REPL avoids restarting a JVM, and reloadable code provides minimal restart of our systems, with the added benefit of always being able to debug the code.</p>
</div>

<div id="post-tags">
    <b>Tags: </b>
    
    <a href="/tags-output/Clojure/">Clojure</a>
    
    <a href="/tags-output/Programming/">Programming</a>
    
</div>


    <div id="prev-next">
        
        
        <a class="right" href="/posts-output/2017-01-10-monads/">Monads: Scala vs. Clojure &raquo;</a>
        
    </div>

    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//theanalyticbastard.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    


</div>

            </div>
        </div>

        <div class="col-md-3">
            <div id="sidebar">
                <!-- <h3>Links</h3>
                <ul id="links">
                    
                    <li><a href="/pages-output/c/">C, C++ and others</a></li>
                    
                    <li><a href="/pages-output/clojure/">Clojure</a></li>
                    
                    <li><a href="/pages-output/courses/">Courses</a></li>
                    
                    <li><a href="/pages-output/databases/">Databases</a></li>
                    
                    <li><a href="/pages-output/experience/">experience</a></li>
                    
                    <li><a href="/pages-output/git/">Git</a></li>
                    
                    <li><a href="/pages-output/intellij/">IntelliJ</a></li>
                    
                    <li><a href="/pages-output/java/">Java</a></li>
                    
                    <li><a href="/pages-output/lein/">Leiningen and Maven</a></li>
                    
                    <li><a href="/pages-output/matlab/">Matlab and R</a></li>
                    
                    <li><a href="/pages-output/mobile/">Mobile</a></li>
                    
                    <li><a href="/pages-output/python/">Python</a></li>
                    
                    <li><a href="/pages-output/scientific/">Scientific Libraries</a></li>
                    
                </ul> -->
                
                <div id="recent">
                    <h3>Recent Posts</h3>
                    <ul>
                        
                        <li><a href="/posts-output/2017-01-17-clojure-good-practices/">Clojure good practices</a></li>
                        
                        <li><a href="/posts-output/2017-01-10-monads/">Monads: Scala vs. Clojure</a></li>
                        
                        <li><a href="/posts-output/2016-09-15-elasticsearch-gis/">Elasticsearch and GIS</a></li>
                        
                        <li><a href="/posts-output/2016-07-08-mysql-fulltext/">MySQL full text search: a simple example</a></li>
                        
                        <li><a href="/posts-output/2016-07-05-mysql-gis/">MySQL GIS capabilities: query geographical locations simple example</a></li>
                        
                    </ul>
                </div>
                
                
                <div id="tags">
                    <h3>Tags</h3>
                    <ul>
                        
                        <li><a href="/tags-output/Matlab/">Matlab</a></li>
                        
                        <li><a href="/tags-output/Mathematics/">Mathematics</a></li>
                        
                        <li><a href="/tags-output/Python/">Python</a></li>
                        
                        <li><a href="/tags-output/Databases/">Databases</a></li>
                        
                        <li><a href="/tags-output/Scala/">Scala</a></li>
                        
                        <li><a href="/tags-output/Elasticsearch/">Elasticsearch</a></li>
                        
                        <li><a href="/tags-output/Biohacking/">Biohacking</a></li>
                        
                        <li><a href="/tags-output/Clojure/">Clojure</a></li>
                        
                        <li><a href="/tags-output/Brainteasers/">Brainteasers</a></li>
                        
                        <li><a href="/tags-output/MySQL/">MySQL</a></li>
                        
                        <li><a href="/tags-output/Tools/">Tools</a></li>
                        
                        <li><a href="/tags-output/Git/">Git</a></li>
                        
                        <li><a href="/tags-output/Statistics/">Statistics</a></li>
                        
                        <li><a href="/tags-output/Programming/">Programming</a></li>
                        
                        <li><a href="/tags-output/Java/">Java</a></li>
                        
                        <li><a href="/tags-output/Hackintosh/">Hackintosh</a></li>
                        
                        <li><a href="/tags-output/Software Development/">Software Development</a></li>
                        
                        <li><a href="/tags-output/Machine Learning/">Machine Learning</a></li>
                        
                    </ul>
                </div>
                

                <script type="text/javascript" src="//rc.revolvermaps.com/0/0/6.js?i=2j1s8v947td&amp;m=7&amp;s=320&amp;c=e63100&amp;cr1=ffffff&amp;f=arial&amp;l=0&amp;bv=90&amp;lx=-420&amp;ly=420&amp;hi=20&amp;he=7&amp;hc=a8ddff&amp;rs=80" async="async"></script>
            </div>
        </div>
    </div>
    <footer>Copyright &copy;  The Analytic Bastard
        <p style="text-align: center;">Powered by <a href="http://cryogenweb.org">Cryogen</a></p></footer>
</div>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="/js/highlight.pack.js" type="text/javascript"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  messageStyle: "none",
  "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
});
</script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-80059282-1', 'auto');
    ga('send', 'pageview');

</script>

</body>
</html>
